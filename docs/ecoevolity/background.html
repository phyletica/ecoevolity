<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Background &#8212; Ecoevolity 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=f237fd5d" />
    <script src="../_static/documentation_options.js?v=01f34227"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Data" href="biallelic-character-data.html" />
    <link rel="prev" title="" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/site-logo.svg" alt="Logo" />
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=phyletica&repo=ecoevolity&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Ecoevolity</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#priors-on-divergence-models">Priors on divergence models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inferring-shared-demographic-changes">Inferring shared demographic changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="biallelic-character-data.html">The Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="yaml-config.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../phycoeval/index.html">Phycoeval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Change History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zbib/references.html">Literature Cited</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html"></a><ul>
      <li>Previous: <a href="index.html" title="previous chapter"></a></li>
      <li>Next: <a href="biallelic-character-data.html" title="next chapter">The Data</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><a class="reference external" href="index.html"><img alt="Ecoevolity" src="../_images/ecoevolity-logo.svg" style="width: 95%;" /></a></p>
<section id="background">
<span id="id1"></span><h1>Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h1>
<p>How do community-scale processes affect diversification?
Environmental processes that drive speciation across whole communities of
species predict divergence times across taxa that are temporally clustered.
Our goal with <a class="reference external" href="http://phyletica.org/ecoevolity">ecoevolity</a> is to provide a tool for testing such predictions
in a full-likelihood Bayesian model choice framework
<span id="id2">[<a class="reference internal" href="../zbib/references.html#id49" title="Jamie R. Oaks. Full Bayesian comparative phylogeography from genomic data. Systematic Biology, 68(3):371–395, 05 2019. URL: https://doi.org/10.1093/sysbio/syy063, doi:10.1093/sysbio/syy063.">14</a>]</span>.
<a class="reference internal" href="#div-island-cartoon"><span class="std std-ref">The cartoon below</span></a> shows an example where two
species of lizards co-diverge when their island is fragmented by rising sea
levels.</p>
<figure class="align-center" id="id19" style="width: 90%">
<span id="div-island-cartoon"></span><a class="reference internal image-reference" href="../_images/div-island-cartoon-event-labels.png"><img alt="divergence model cartoon" src="../_images/div-island-cartoon-event-labels.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">A cartoon showing three pairs of insular lizard species, two of which
co-diverged when the island was fragmented.</span><a class="headerlink" href="#id19" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>If we collect genetic data from all six populations, and we want to
evaluate whether the scenario above is a good explanation for the patterns
in our data, there are other possible scenarios (models) that we need
to consider.
For example, perhaps all three pairs of populations diverged at the
same time:</p>
<figure class="align-center" id="id20" style="width: 90%">
<span id="divmodel-111"></span><a class="reference internal image-reference" href="../_images/div-model-111-labels.svg"><img alt="divergence model 111" src="../_images/div-model-111-labels.svg" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">All three pairs of lizard species co-diverged.</span><a class="headerlink" href="#id20" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Also, there are three possible ways our three pairs of species could have
diverged at two different times:</p>
<figure class="align-center" id="divmodel-211" style="width: 90%">
<a class="reference internal image-reference" href="../_images/div-model-311-labels.svg"><img alt="divergence model 311" src="../_images/div-model-311-labels.svg" style="width: 600px;" />
</a>
</figure>
<figure class="align-center" style="width: 90%">
<a class="reference internal image-reference" href="../_images/div-model-131-labels.svg"><img alt="divergence model 131" src="../_images/div-model-131-labels.svg" style="width: 600px;" />
</a>
</figure>
<figure class="align-center" id="id21" style="width: 90%">
<a class="reference internal image-reference" href="../_images/div-model-113-labels.svg"><img alt="divergence model 113" src="../_images/div-model-113-labels.svg" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Three possible ways our three pairs of lizard species diverged at two
different times.</span><a class="headerlink" href="#id21" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Finally, it’s also possible that all three pairs diverged independently:</p>
<figure class="align-center" id="id22" style="width: 90%">
<span id="divmodel-123"></span><a class="reference internal image-reference" href="../_images/div-model-213-labels.svg"><img alt="divergence model 123" src="../_images/div-model-213-labels.svg" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Three independent divergences.</span><a class="headerlink" href="#id22" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>If we want to test for patterns of shared (non-independent) divergences, this
last scenario of independent divergences seems like a sensible null model.
Overall, we have five possible models that differ in how the three pairs of
species are partitioned into divergence groups (or “events”).
In other words, the models differ in the number of divergence-time parameters
and how we assign our species pairs to them.</p>
<p>Now, we need a way to compare how well these five models explain our genetic
data.
Assuming a probabilistic model of how our sequences evolved (more on that in a
bit), we can derive the function for the probability of the data from one of
our pairs of populations given the time of divergence and the effective sizes
of the ancestral and descendant populations (i.e., the likelihood of the
population history).
With the likelihood function in hand, for each of our five possible models, we
can find the combination of parameter values (divergence times and population
sizes) that maximize the likelihood that the model produced our data.
Then, we can compare the ML scores among our models (while in some way
penalizing models with more divergence-time parameters) to select our preferred
model.
.. However, this ML approach does not allow us to say anything about the
.. probability of the models themselves (only the data).
However, as the number of pairs we wish to compare increases, this
ML approach becomes daunting.
The number of possible models we need to consider is
the <a class="reference external" href="http://en.wikipedia.org/wiki/Bell_number">Bell number</a>
<span id="id3">[<a class="reference internal" href="../zbib/references.html#id683" title="E. T. Bell. Exponential numbers. American Mathematical Monthly, 41:411-419, 1934.">2</a>]</span>.
For 5, 10, and 20 pairs, there are 52, 115,975, and 51,724,158,235,372 possible
divergence models, respectively.
A Bayesian model-averaging approach is appealing, because it allows the data to
determine which models are most relevant, and it allows us to make probability
statements about the models given the data.</p>
<p>Methods like msBayes
<span id="id4">[<a class="reference internal" href="../zbib/references.html#id801" title="Michael J. Hickerson, Eli A. Stahl, and H. A. Lessios. Test for simultaneous divergence using approximate Bayesian computation. Evolution, 60(12):2435-2453, 2006.">6</a>, <a class="reference internal" href="../zbib/references.html#id640" title="Wen Huang, Naoki Takebayashi, Yan Qi, and Michael J. Hickerson. MTML-msBayes: approximate Bayesian comparative phylogeographic inference from multiple taxa and multiple loci with rate heterogeneity. BMC Bioinformatics, 12:1, 2011. doi:10.1186/1471-2105-12-1.">8</a>]</span>
and dpp-msbayes
<span id="id5">[<a class="reference internal" href="../zbib/references.html#id58" title="Jamie R. Oaks. An improved approximate-bayesian model-choice method for estimating shared evolutionary history. BMC Evolutionary Biology, 14:150, 07 2014. URL: http://www.biomedcentral.com/1471-2148/14/150/abstract, doi:10.1186/1471-2148-14-150.">13</a>]</span>
attempt to perform this type of model-averaging
using approximate-likelihood Bayesian computation (ABC).
Rather than compute the likelihood, these methods use simulations
to approximate it.
These methods often struggle to detect multiple divergence times across pairs
of populations
<span id="id6">[<a class="reference internal" href="../zbib/references.html#id55" title="Jamie R. Oaks, Charles W. Linkem, and Jeet Sukumaran. Implications of uniformly distributed, empirically informed priors for phylogeographical model selection: a reply to hickerson et al. Evolution, 68():3607–3617, 12 2014. URL: http://onlinelibrary.wiley.com/doi/10.1111/evo.12523/abstract, doi:10.1111/evo.12523.">17</a>, <a class="reference internal" href="../zbib/references.html#id62" title="Jamie R. Oaks, Jeet Sukumaran, Jacob A. Esselstyn, Charles W. Linkem, Cameron D. Siler, Mark T. Holder, and Rafe M. Brown. Evidence for climate-driven diversification? a caution for interpreting ABC inferences of simultaneous historical events. Evolution, 67(4):991–1010, 04 2013. doi:10.1111/j.1558-5646.2012.01840.x.">19</a>]</span>,
are very sensitive to prior assumptions
<span id="id7">[<a class="reference internal" href="../zbib/references.html#id517" title="Michael J. Hickerson, Graham N. Stone, Konrad Lohse, Terrence. C. Demos, Xiaoou Xie, Cedric Landerer, and Naoki Takebayashi. Recommendations for using msbayes to incorporate uncertainty in selecting an ABC model prior: a response to Oaks et al. Evolution, 68(1):284–294, 2014. URL: http://doi.wiley.com/10.1111/evo.12241, doi:10.1111/evo.12241.">7</a>, <a class="reference internal" href="../zbib/references.html#id55" title="Jamie R. Oaks, Charles W. Linkem, and Jeet Sukumaran. Implications of uniformly distributed, empirically informed priors for phylogeographical model selection: a reply to hickerson et al. Evolution, 68():3607–3617, 12 2014. URL: http://onlinelibrary.wiley.com/doi/10.1111/evo.12523/abstract, doi:10.1111/evo.12523.">17</a>, <a class="reference internal" href="../zbib/references.html#id62" title="Jamie R. Oaks, Jeet Sukumaran, Jacob A. Esselstyn, Charles W. Linkem, Cameron D. Siler, Mark T. Holder, and Rafe M. Brown. Evidence for climate-driven diversification? a caution for interpreting ABC inferences of simultaneous historical events. Evolution, 67(4):991–1010, 04 2013. doi:10.1111/j.1558-5646.2012.01840.x.">19</a>]</span>,
or have little information to update <em>a priori</em> expectations
<span id="id8">[<a class="reference internal" href="../zbib/references.html#id58" title="Jamie R. Oaks. An improved approximate-bayesian model-choice method for estimating shared evolutionary history. BMC Evolutionary Biology, 14:150, 07 2014. URL: http://www.biomedcentral.com/1471-2148/14/150/abstract, doi:10.1186/1471-2148-14-150.">13</a>]</span>.
Furthermore, the loss of information inherent to ABC approaches can prevent
them from accurately selecting models
<span id="id9">[<a class="reference internal" href="../zbib/references.html#id323" title="Peter J. Green, Krzysztof Łatuszyński, Marcelo Pereyra, and Christian P. Robert. Bayesian computation: a summary of the current state, and samples backwards and forwards. Statistics and Computing, 25(4):835–862, 2015. URL: https://doi.org/10.1007/s11222-015-9574-5, doi:10.1007/s11222-015-9574-5.">5</a>, <a class="reference internal" href="../zbib/references.html#id322" title="Jean‐Michel Marin, Natesh S. Pillai, Christian P. Robert, and Judith Rousseau. Relevant statistics for bayesian model choice. Journal of the Royal Statistical Society: Series B (Statistical Methodology), 76(5):833–859, 2013. URL: https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/rssb.12056, arXiv:https://rss.onlinelibrary.wiley.com/doi/pdf/10.1111/rssb.12056, doi:10.1111/rssb.12056.">11</a>, <a class="reference internal" href="../zbib/references.html#id579" title="Christian P Robert, Jean-Marie Cornuet, Jean-Michel Marin, and Natesh S Pillai. Lack of confidence in approximate Bayesian computation model choice. Proceedings of the National Academy of Sciences, 108(37):15112–15117, September 2011.">22</a>]</span>.</p>
<p>Our goal with <a class="reference external" href="http://phyletica.org/ecoevolity">ecoevolity</a> is to overcome some of these limitations by accommodating
genomic data (which we’ll denote as <img class="math" src="../_images/math/707409ba5a0d21c07c5ff2eda74b28d0f26d1ae2.svg" alt="\alldata"/>), and using all the
information in those data.
We do this by computing the full likelihood of the models described above.
Ecoevolity models biallelic characters from across the genome as having evolved
along their respective gene trees according to continuous time Markov chain of
state change.
It assumes a two-state equivalent of either the Jukes-Cantor (JC69) or general
time-reversible (GTR) of nucleotide substitution
<span id="id10">[<a class="reference internal" href="../zbib/references.html#id365" title="Thomas. H. Jukes and Charles. R. Cantor. Evolution of protein molecules. In H. N. Munro, editor, Mammalian Protein Metabolism, volume III, chapter 24, pages 21–132. Academic Press, New York, 1969.">9</a>, <a class="reference internal" href="../zbib/references.html#id295" title="Simon Tavaré. Some probabilistic and statistical problems in the analysis of DNA sequences. In Robert M. Miura, editor, Some Mathematical Questions in Biology: DNA Sequence Analysis, pages 57–86. American Mathematical Society, Providence, Rhode Island, USA, 1986.">25</a>]</span>.
Furthermore, ecoevolity assumes each gene tree branched within the populations
according to a coalescent model
<span id="id11">[<a class="reference internal" href="../zbib/references.html#id837" title="John F. C. Kingman. The coalescent. Stochastic processes and their applications, 13:235–248, 1982.">10</a>]</span>.
Given one of the possible divergence models (<img class="math" src="../_images/math/7d50896ec0918c9cd3a24996a9b98da35121b6a1.svg" alt="\model"/>) and values of its
parameters (<img class="math" src="../_images/math/3cf1eb608c623b46eb5ca8252425ca1bb78b5820.svg" alt="parameters"/>; divergence times, effective population sizes,
and state frequencies), ecoevolity directly computes the probability of the
biallelic characters,
<img class="math" src="../_images/math/fddd84e3d68e73b7f5e65679a0288dc781bd1b40.svg" alt="\pr(\alldata \given \parameters, \model)"/>.
By doing so, ecoevolity effectively integrates over all possible gene trees and
character substitution histories along those tries, during the likelihood
calculation.
This frees ecoevolity from having to estimate the gene trees, and is all thanks to
the work of David Bryant and colleagues <span id="id12">[<a class="reference internal" href="../zbib/references.html#id558" title="David Bryant, Remco Bouckaert, Joseph Felsenstein, Noah A. Rosenberg, and Arindam Roychoudhury. Inferring species trees directly from biallelic genetic markers: bypassing gene trees in a full coalescent analysis. Molecular Biology and Evolution, 29(8):1917–1932, 2012. doi:10.1093/molbev/mss086.">3</a>]</span>.</p>
<p>Using this likelihood function and Markov chain Monte Carlo (MCMC),
Ecoevolity jointly samples the posterior across all possible models:</p>
<div class="math" id="equation-jointposterior">
<p><span class="eqno">(1)<a class="headerlink" href="#equation-jointposterior" title="Link to this equation">¶</a></span><img src="../_images/math/0099fa1dcb12275394b5c6afe12ddab3f48a9ced.svg" alt="\pr(\parameters, \model[i] \given \alldata) =
\frac{
    \pr(\alldata \given \parameters, \model[i])
    \pr(\parameters \given \model[i])
    \pr(\model[i])
}{
    \pr(\alldata)
    % \sum_{i}\int_{\parameters}
    % \pr(\alldata \given \parameters, \model[i])
    % \pr(\parameters \given \model[i])
    % \diff{\parameters}
    % \pr(\model[i])
},"/></p>
</div><p>Once we have our samples from the joint posterior above, we can marginalize all
the parameters to approximate the posterior probabilities of the divergence
models:</p>
<div class="math" id="equation-marginalposterior">
<p><span class="eqno">(2)<a class="headerlink" href="#equation-marginalposterior" title="Link to this equation">¶</a></span><img src="../_images/math/8b7aebc0646536ea6e6d47cd05e77ff9481d6820.svg" alt="\pr(\model[i] \given \alldata) &amp;=
\frac{
    \int_{\parameters}
    \pr(\alldata \given \parameters, \model[i])
    \pr(\parameters \given \model[i])
    \diff{\parameters}
    \;\; \pr(\model[i])
}{
    \pr(\alldata)
    % \sum_{i}
    % \pr(\alldata \given \model[i])
    % \pr(\model[i])
} \\
&amp;=
\frac{
    \pr(\alldata \given \model[i])
    \pr(\model[i])
}{
    \pr(\alldata)
    % \sum_{i}
    % \pr(\alldata \given \model[i])
    % \pr(\model[i])
}"/></p>
</div><p>We can get Monte Carlo approximations of these probabilities by simply looking
at the proportion of the posterior samples that are from each model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The term <img class="math" src="../_images/math/ab9c4c588572eaf9703bd8d5f21fe283693d4e2c.svg" alt="\pr(\alldata \given \model[i])"/> Equation
<a class="reference internal" href="#equation-marginalposterior">(2)</a> is absolutely critical.
This is the <em>marginal likelihood</em> of model <img class="math" src="../_images/math/8038fb8747729c3dc1d125ff543c85b276eb7f80.svg" alt="i"/>, which updates
our prior to give us the posterior probability for model <img class="math" src="../_images/math/8038fb8747729c3dc1d125ff543c85b276eb7f80.svg" alt="i"/>.
The marginal likelihood is the model’s likelihood “averaged” over all
possible values of the parameters, and the average is weighted by the
priors on those parameters.
As a result, the marginal likelihood of each model can be very sensitive to
the priors we choose for the parameters, even if we have a lot of
informative data.
Accordingly, we <strong>highly recommend</strong> you analyze your data multiple times
using different prior settings (especially the prior on divergence times)
to assess how sensitive your results are to the priors.</p>
</div>
<section id="priors-on-divergence-models">
<span id="prior-on-divergence-models"></span><h2>Priors on divergence models<a class="headerlink" href="#priors-on-divergence-models" title="Link to this heading">¶</a></h2>
<p>To sample from the posterior in Equation <a class="reference internal" href="#equation-jointposterior">(1)</a>,
we have to assume a prior on all the possible ways our pairs of species
diverged (divergence models).
As of Version 1.0.0, Ecoevolity treats the divergence model (number of divergence
events, and the assignment of the taxa to the events) as a random variable
under three different distributions:
The Dirichlet process, Pitman-Yor process, and uniform.
Prior to Version 1.0.0, only the Dirichlet process was implemented.</p>
<section id="dirichlet-process-prior">
<span id="dp-prior-on-divergence-models"></span><h3>Dirichlet-process prior<a class="headerlink" href="#dirichlet-process-prior" title="Link to this heading">¶</a></h3>
<p>The basic idea of the Dirichlet process
<span id="id13">[<a class="reference internal" href="../zbib/references.html#id550" title="Charles E. Antoniak. Mixtures of Dirichlet processes with applications to Bayesian nonparametric problems. Annals of Statistics, 2(6):1152–1174, 1974.">1</a>, <a class="reference internal" href="../zbib/references.html#id607" title="Thomas S Ferguson. A Bayesian Analysis of Some Nonparametric Problems. The Annals of Statistics, 1(2):209–230, March 1973.">4</a>]</span>
is quite simple; we assign species
pairs to divergence events one at a time following a very simple rule.
When assigning the <img class="math" src="../_images/math/ea81a5e81081e0f84c8898a08c57438c3163a071.svg" alt="n^{th}"/> pair, we assign it to its own
event (i.e., a new divergence event) with probability</p>
<div class="math" id="equation-dppnewcat">
<p><span class="eqno">(3)<a class="headerlink" href="#equation-dppnewcat" title="Link to this equation">¶</a></span><img src="../_images/math/0efc7ec41bcd1e233bb49cfd9e100b2b40b9827e.svg" alt="\frac{\alpha}{\alpha + n -1}"/></p>
</div><p>or you assign it to an existing event <img class="math" src="../_images/math/9dd0fca08511a9e1e7a5a9b5583826f2ab695bd1.svg" alt="x"/> with probability</p>
<div class="math" id="equation-dppexistingcat">
<p><span class="eqno">(4)<a class="headerlink" href="#equation-dppexistingcat" title="Link to this equation">¶</a></span><img src="../_images/math/62f733e8bbe9fdf7817f071294799f4ad0f2bfb5.svg" alt="\frac{n_x}{\alpha + n -1}"/></p>
</div><p>where <img class="math" src="../_images/math/44d89a769ae8b6c4f012093eb4fa62cafd22db29.svg" alt="n_x"/> is the number of pairs already assigned to
event <img class="math" src="../_images/math/9dd0fca08511a9e1e7a5a9b5583826f2ab695bd1.svg" alt="x"/>.
Let’s walk through an example using our three pairs of lizard species.
First, we have to assign our first pair (“A”) to a
divergence event with probability 1.0;
let’s call this the “blue” divergence event.
Next we assign the second pair (“B”) to either a new (“red”) divergence
event with probability <img class="math" src="../_images/math/77605b451a727cc70e91329c1add6d7344a54729.svg" alt="\alpha/\alpha + 1"/> or to the same “blue”
divergence event as the first pair with probability <img class="math" src="../_images/math/a7a2176de02d11e1395cd6670259995129211b9f.svg" alt="1/\alpha + 1"/>.
For this example, let’s say it gets assigned to the “blue” event.
Lastly, we assign the third pair (“C”) to either a new (“red”) divergence
event with probability <img class="math" src="../_images/math/47ffa66873cfdcfbe1f5931222ee62148b83bd61.svg" alt="\alpha/\alpha + 2"/> or to the same “blue”
divergence event as the first two pairs with probability <img class="math" src="../_images/math/445f6915d11e8b6dc8e5ffcb367a9dfdb95a2984.svg" alt="2/\alpha +
2"/>.</p>
<p>The GIF below illustrates how the these simple rules determine the
prior probability of all five possible models.
Notice toward the end of the animation, as the concentration parameter
increases we place more probability on the divergence models with more
independent divergence events (less shared divergences).</p>
<figure class="align-center" id="id23" style="width: 90%">
<span id="dpp-tree"></span><a class="reference internal image-reference" href="../_images/dpp-3-example.gif"><img alt="DPP example" src="../_images/dpp-3-example.gif" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">An example of the Dirichlet process.</span><a class="headerlink" href="#id23" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Notice that the Dirichlet process prior (DPP) is not motivated by any
biological processes.
Rather, we use it because it is flexible (we can adjust or estimate the
concentration parameter), and mathematically convenient; it allows us to use
Gibbs sampling <span id="id14">[<a class="reference internal" href="../zbib/references.html#id899" title="R. M. Neal. Markov chain sampling methods for Dirichlet process mixture models. Journal of Computational and Graphical Statistics, 9:249-265, 2000.">12</a>]</span> to sample across divergence models.</p>
</section>
<section id="pitman-yor-process-prior">
<span id="pyp-prior-on-divergence-models"></span><h3>Pitman-Yor process prior<a class="headerlink" href="#pitman-yor-process-prior" title="Link to this heading">¶</a></h3>
<p>One of the newly implemented ways of modeling shared divergences is
the Pitman-Yor process (PYP) <span id="id15">[<a class="reference internal" href="../zbib/references.html#id666" title="Jim Pitman and Marc Yor. The two-parameter Poisson-Dirichlet distribution derived from a stable subordinator. Annals of Probability, 25(2):855-900, 1997.">21</a>]</span>.
The PYP is a generalization of the Dirichlet process.
It adds an additional parameter called the “discount” parameter, which
we will denote as <img class="math" src="../_images/math/df4b4e36a15e9b9041061074b6e5141aa12b3f16.svg" alt="d"/>.
When <img class="math" src="../_images/math/e0bbb18b2f2c468be20e86972e80b159fb55cfc3.svg" alt="d = 0"/> the PYP is equivalent to the DP.
The discount parameter gives the PYP flexibility over the tail behavior of the
process (the DP has exponential tails).</p>
<p>The rule governing the PYP is very similar to the DP.
When assigning the <img class="math" src="../_images/math/ea81a5e81081e0f84c8898a08c57438c3163a071.svg" alt="n^{th}"/> pair, we assign it to its own event (i.e., a
new divergence event with a unique time) with probability</p>
<div class="math" id="equation-pypnewcat">
<p><span class="eqno">(5)<a class="headerlink" href="#equation-pypnewcat" title="Link to this equation">¶</a></span><img src="../_images/math/8352ee8db585ef4071b72cc3293c256ed40a2e60.svg" alt="\frac{\alpha + k d}{\alpha + n -1}"/></p>
</div><p>where <img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> is the number of events that currently exist (i.e., that
already have a pair assigned to it).
Or, we assign it to an existing event <img class="math" src="../_images/math/9dd0fca08511a9e1e7a5a9b5583826f2ab695bd1.svg" alt="x"/> with probability</p>
<div class="math" id="equation-pypexistingcat">
<p><span class="eqno">(6)<a class="headerlink" href="#equation-pypexistingcat" title="Link to this equation">¶</a></span><img src="../_images/math/6d1bd8761705996c562302f9a78e59d1619b2d25.svg" alt="\frac{n_x - d}{\alpha + n -1}"/></p>
</div><p>where <img class="math" src="../_images/math/44d89a769ae8b6c4f012093eb4fa62cafd22db29.svg" alt="n_x"/> is the number of pairs already assigned to
event <img class="math" src="../_images/math/9dd0fca08511a9e1e7a5a9b5583826f2ab695bd1.svg" alt="x"/>.</p>
<p>The animation below illustrates how the these rules of the PYP determine the
prior probability of all five possible models of divergence.
Notice toward the end of the animation, as the discount parameter
increases we place more probability on the divergence models with more
independent divergence events (less shared divergences).
Again, when the discount parameter is zero, the PYP is equivalent to the DP.</p>
<figure class="align-center" id="id24" style="width: 90%">
<span id="pyp-tree"></span><a class="reference internal image-reference" href="../_images/pyp-3-example.gif"><img alt="PYP example" src="../_images/pyp-3-example.gif" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">An example of the Pitman-Yor process.</span><a class="headerlink" href="#id24" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference external" href="http://phyletica.org/pyp-demo/">Click here for a larger, interactive demonstration of the PYP</a>.</p>
<p>With an extra parameter, the PYP has greater flexibility than the DP.
We can adjust both the concentration and discount parameters to fit our prior
expectations.
Also, we can put distributions on both of these parameters and integrate over
uncertainty about the prior probabilities of the divergence models.
The PYP preserves the mathematical conveniences of the DP.
We can quickly calculate the probability of any model, and
the exchangeability property still allows us to use Gibbs sampling to
sample across possible divergence models.</p>
<section id="uniform-prior">
<span id="uniform-prior-on-divergence-models"></span><h4>Uniform prior<a class="headerlink" href="#uniform-prior" title="Link to this heading">¶</a></h4>
<p>We have also implemented a uniform prior over divergence models, where we
assume <em>a priori</em> that every possible divergence model (every way of grouping
the divergence times of the population pairs) is equally probable.
Furthermore, we added a “split weight” parameter, which we denote as <img class="math" src="../_images/math/d6e83727e939e2544686dc17c7223374c1e90497.svg" alt="s"/>,
to provide some flexibility to this prior on divergence models.</p>
<p>We can think of the split weight (<img class="math" src="../_images/math/d6e83727e939e2544686dc17c7223374c1e90497.svg" alt="s"/>) in simple terms.
For a given model with <img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> divergence events (i.e., divergence time
categories), the relative probability of each model with
<img class="math" src="../_images/math/7604d0f89a362a500dc0868ff80691acc966f688.svg" alt="k + 1"/> events is <img class="math" src="../_images/math/d6e83727e939e2544686dc17c7223374c1e90497.svg" alt="s"/>,
and the relative probability of each model with
<img class="math" src="../_images/math/e35b6f8c0d8eb1e3a34ff1974e95b636b79751e6.svg" alt="k - 1"/> events is <img class="math" src="../_images/math/c290c9eb68fa586c68109ff0bf1e5aadaa95b420.svg" alt="\frac{1}{s}"/>.
More generally, the relative probability of each model with
<img class="math" src="../_images/math/6f13d6086395a662201a7664837f429b57c70af3.svg" alt="k + n"/> events is <img class="math" src="../_images/math/ec44d13c8cf56c918535b9d4068dded25e7d1f51.svg" alt="s^n"/>,
and the relative probability of each model with
<img class="math" src="../_images/math/42667ef1c6b4e771c8433efed0221c4b6bfdf0eb.svg" alt="k - n"/> events is <img class="math" src="../_images/math/339095b076cd8c94391d8a751d775d4cc706a277.svg" alt="\frac{1}{s^n}"/>.</p>
<p>To get a feel for this “uniform” prior, in the following tables we will look at
an example for 4 pairs of populations, with 3 different values for the split
weight. First, some notation that is used in the tables:</p>
<dl class="simple">
<dt><img class="math" src="../_images/math/381a5fe04c541ac32779e9bf9078df85eadfc28d.svg" alt="N"/></dt><dd><p>The number of population pairs we are comparing.</p>
</dd>
<dt><img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/></dt><dd><p>The number of divergence events (i.e., divergence time categories).</p>
</dd>
<dt><img class="math" src="../_images/math/3e104f64316fd981aa06b46ac1e72b6cbbddaaf6.svg" alt="S(N, k)"/></dt><dd><p>The number of models that have <img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> categories (the Stirling number of
the second kind).</p>
</dd>
<dt><img class="math" src="../_images/math/5dddee72c9fb1a47a8a50a24594f762ab758b8a3.svg" alt="s^{k-1}"/></dt><dd><p>The relative probability of each model with <img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> events (we scale this
relative probability to help make the tables readable).</p>
</dd>
<dt><img class="math" src="../_images/math/79b0db30cab616d0dfabe72b51dbb7bd5488515d.svg" alt="s^{k-1}S(N, k)"/></dt><dd><p>The relative probability of the entire class of divergence models with
<img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> events.</p>
</dd>
<dt><img class="math" src="../_images/math/accb44b8317b970afb9c764929cb74148bb581cb.svg" alt="p(m_k)"/></dt><dd><p>The probability of <em>each</em> divergence model with <img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/> events.</p>
</dd>
</dl>
<p>Split weight <img class="math" src="../_images/math/c7f34e4d1ae4a54da2231f4f16f866e000dc828d.svg" alt="s = 1.0"/>:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/></p></td>
<td><p><img class="math" src="../_images/math/402272f73cd28afb71f367dbdeb46e55c087299e.svg" alt="S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/5dddee72c9fb1a47a8a50a24594f762ab758b8a3.svg" alt="s^{k-1}"/></p></td>
<td><p><img class="math" src="../_images/math/041eb747ebffb53878a54efaf368715802694cd3.svg" alt="s^{k-1}S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/accb44b8317b970afb9c764929cb74148bb581cb.svg" alt="p(m_k)"/></p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p><img class="math" src="../_images/math/b5e0864a66bdc15edb0d0d6ce30d180f9bad1276.svg" alt="\frac{1}{15}"/></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>7</p></td>
<td><p>1</p></td>
<td><p>7</p></td>
<td><p><img class="math" src="../_images/math/b5e0864a66bdc15edb0d0d6ce30d180f9bad1276.svg" alt="\frac{1}{15}"/></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
<td><p>6</p></td>
<td><p><img class="math" src="../_images/math/b5e0864a66bdc15edb0d0d6ce30d180f9bad1276.svg" alt="\frac{1}{15}"/></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p><img class="math" src="../_images/math/b5e0864a66bdc15edb0d0d6ce30d180f9bad1276.svg" alt="\frac{1}{15}"/></p></td>
</tr>
</tbody>
</table>
<p>Split weight <img class="math" src="../_images/math/6450067262fc0fbedcb5b42371a8e9a71dba930d.svg" alt="s = 2.0"/>:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/></p></td>
<td><p><img class="math" src="../_images/math/402272f73cd28afb71f367dbdeb46e55c087299e.svg" alt="S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/5dddee72c9fb1a47a8a50a24594f762ab758b8a3.svg" alt="s^{k-1}"/></p></td>
<td><p><img class="math" src="../_images/math/041eb747ebffb53878a54efaf368715802694cd3.svg" alt="s^{k-1}S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/accb44b8317b970afb9c764929cb74148bb581cb.svg" alt="p(m_k)"/></p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p><img class="math" src="../_images/math/ec034c7fa6f775f19babe2e2b4880057480398c3.svg" alt="\frac{1}{47}"/></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>7</p></td>
<td><p>2</p></td>
<td><p>14</p></td>
<td><p><img class="math" src="../_images/math/66f4ca7907c90f85cb47c7f42ea72ddc0866f4ca.svg" alt="\frac{2}{47}"/></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>6</p></td>
<td><p>4</p></td>
<td><p>24</p></td>
<td><p><img class="math" src="../_images/math/7ec80c50a0bcb8922385647267f5b145a40520f2.svg" alt="\frac{4}{47}"/></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
<td><p>8</p></td>
<td><p><img class="math" src="../_images/math/bf174504fda941ffe42d0393f6ef301b2a2265b0.svg" alt="\frac{8}{47}"/></p></td>
</tr>
</tbody>
</table>
<p>Split weight <img class="math" src="../_images/math/7dc6dc400622d1cebe16093510adeb930640034b.svg" alt="s = \frac{1}{2}"/>:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><img class="math" src="../_images/math/c387d3af1b09825f0e99b2f48ebf0397d16ad71e.svg" alt="k"/></p></td>
<td><p><img class="math" src="../_images/math/402272f73cd28afb71f367dbdeb46e55c087299e.svg" alt="S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/5dddee72c9fb1a47a8a50a24594f762ab758b8a3.svg" alt="s^{k-1}"/></p></td>
<td><p><img class="math" src="../_images/math/041eb747ebffb53878a54efaf368715802694cd3.svg" alt="s^{k-1}S(N,k)"/></p></td>
<td><p><img class="math" src="../_images/math/accb44b8317b970afb9c764929cb74148bb581cb.svg" alt="p(m_k)"/></p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
<td><p>8</p></td>
<td><p><img class="math" src="../_images/math/1cd723564e0ac866ee48e531551f9613f0c82ef4.svg" alt="\frac{8}{49}"/></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>7</p></td>
<td><p>4</p></td>
<td><p>28</p></td>
<td><p><img class="math" src="../_images/math/c77e04091429ab1335b7d378a9458b4fd732f850.svg" alt="\frac{4}{49}"/></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>6</p></td>
<td><p>2</p></td>
<td><p>12</p></td>
<td><p><img class="math" src="../_images/math/8030e77f91c89fdb64f96aaf2015442f7f2b5896.svg" alt="\frac{2}{49}"/></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p><img class="math" src="../_images/math/beb5bdc718f04172d5c0d30affe4d266b75a075b.svg" alt="\frac{1}{49}"/></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="inferring-shared-demographic-changes">
<h2>Inferring shared demographic changes<a class="headerlink" href="#inferring-shared-demographic-changes" title="Link to this heading">¶</a></h2>
<p>In addition to the divergence models discussed above, with ecoevolity, you can also
infer shared changes in effective population size.
For example, insular species of lizards might increase their population sizes
when their island coalesces with another island:</p>
<figure class="align-center" style="width: 90%">
<a class="reference internal image-reference" href="../_images/demog-island-cartoon-event-labels.png"><img alt="divergence model cartoon" src="../_images/demog-island-cartoon-event-labels.png" style="width: 600px;" />
</a>
</figure>
<p>Also, ecoevolity allows you to infer a mix of divergences and population
expansions/contractions:</p>
<figure class="align-center" style="width: 90%">
<a class="reference internal image-reference" href="../_images/mixed-island-cartoon-event-labels.png"><img alt="divergence model cartoon" src="../_images/mixed-island-cartoon-event-labels.png" style="width: 600px;" />
</a>
</figure>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer" role="contentinfo" align="center">
    <a href="https://github.com/phyletica/ecoevolity">GitHub</a> &nbsp; | &nbsp; <a href="../license.html">License</a> &nbsp; | &nbsp; <a href="../citation.html">Citation</a> &nbsp; | &nbsp; <a href="https://groups.google.com/forum/#!forum/ecoevolity-users">Users Forum</a>
</div>

  </body>
</html>